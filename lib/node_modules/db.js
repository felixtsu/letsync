var redis = require('redis');
var env = require('./env');

const DB_NAME = 'maindb';

var RedisHelper = function() {

    this.client = redis.createClient(env.redisPort, env.redisHost);
    if (env.redisPassword) {
        this.client.auth(env.redisPassword, function(err) {
            if (err) {
                throw err;
            }
        });
    }

    var self = this;
    self.client.select(DB_NAME);
    self.client.on("connect", function() {
        self.selectDbOnConnect();
    });
};

RedisHelper.prototype.selectDbOnConnect = function() {
    this.client.send_anyways = true;
    this.client.select(DB_NAME);
    this.client.send_anyways = false;
};

var get = RedisHelper.prototype.get = function(key, cb) {
    this.client.get(key, function(err, reply) {
        if (err) {
            throw new Error(err);
        }

        cb(reply);
    });
};

var set = RedisHelper.prototype.set = function(key, value, cb) {
    this.client.set(key, value, function(err, reply) {
        if (err) {
            throw new Error(err);
        }
        if (cb) {
            cb(reply);
        }
    });
};


var helper = new RedisHelper();

exports.get = function() {
    get.apply(helper, arguments);
};

exports.set = function() {
    set.apply(helper, arguments);
};

exports.getClient = function() {
    return helper.client;
};

//for (k in helper.client) {
//    if (typeof helper.client[k] == 'function') {
//        exports[k] = helper.client[k];
//    }
//}
